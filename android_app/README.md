# ğŸ“± æ°´å¡”ç›‘æ§ Android APP

åŸºäº Kotlin çš„æ°´å¡”ç›‘æ§ç³»ç»Ÿ Android å®¢æˆ·ç«¯

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- âœ… **å®æ—¶æ°´ä½ç›‘æ§** - 5 ç§’è‡ªåŠ¨åˆ·æ–°å„æ°´å¡”æ°´ä½
- âœ… **æ°´æ³µè¿œç¨‹æ§åˆ¶** - æ‰‹åŠ¨å¼€å¯/å…³é—­æ¯ä¸ªæ°´å¡”çš„æ°´æ³µ
- âœ… **è‡ªåŠ¨/æ‰‹åŠ¨æ¨¡å¼åˆ‡æ¢** - æ™ºèƒ½è‡ªåŠ¨æ§åˆ¶æˆ–è¿œç¨‹æ‰‹åŠ¨æ§åˆ¶
- âœ… **ç¼ºæ°´æŠ¥è­¦** - äº•æ°´ç¼ºæ°´æ—¶æ¨é€é€šçŸ¥
- âœ… **å†å²è®°å½•** - æŸ¥çœ‹æ°´ä½å˜åŒ–æ›²çº¿
- âœ… **å¤šæ°´å¡”ç®¡ç†** - æ”¯æŒæœ€å¤š 8 ä¸ªæ°´å¡”
- âœ… **åœ¨çº¿çŠ¶æ€æ˜¾ç¤º** - å®æ—¶æ˜¾ç¤ºä»æœºåœ¨çº¿/ç¦»çº¿çŠ¶æ€

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Android 8.0 (API 26) åŠä»¥ä¸Š
- WiFi ç½‘ç»œè¿æ¥
- å­˜å‚¨ç©ºé—´ï¼šè‡³å°‘ 50MB

## ğŸ”§ ç¼–è¯‘è¯´æ˜

### æ–¹æ³• 1: Android Studio (æ¨è)

1. **å®‰è£… Android Studio**
   - ä¸‹è½½ï¼šhttps://developer.android.com/studio
   - å®‰è£…å¹¶æ‰“å¼€

2. **æ‰“å¼€é¡¹ç›®**
   - File â†’ Open
   - é€‰æ‹© `android_app` æ–‡ä»¶å¤¹

3. **ç­‰å¾… Gradle åŒæ­¥**
   - é¦–æ¬¡æ‰“å¼€ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–
   - å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ

4. **è¿è¡Œ APP**
   - è¿æ¥ Android è®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨
   - ç‚¹å‡» Run æŒ‰é’® (ç»¿è‰²ä¸‰è§’å½¢)

5. **ç”Ÿæˆ APK**
   - Build â†’ Build Bundle(s) / APK(s) â†’ Build APK(s)
   - APK ä½ç½®ï¼š`app/build/outputs/apk/debug/app-debug.apk`

### æ–¹æ³• 2: å‘½ä»¤è¡Œç¼–è¯‘

```bash
cd android_app

# Windows
gradlew.bat assembleDebug

# Linux/Mac
./gradlew assembleDebug

# ç”Ÿæˆ Release ç‰ˆæœ¬
./gradlew assembleRelease
```

APK è¾“å‡ºä½ç½®ï¼š
- Debug: `app/build/outputs/apk/debug/app-debug.apk`
- Release: `app/build/outputs/apk/release/app-release-unsigned.apk`

## ğŸ“² å®‰è£…è¯´æ˜

### é€šè¿‡ USB å®‰è£…

1. å¯ç”¨å¼€å‘è€…é€‰é¡¹ï¼š
   - è®¾ç½® â†’ å…³äºæ‰‹æœº â†’ è¿ç»­ç‚¹å‡»"ç‰ˆæœ¬å·"7 æ¬¡
2. å¯ç”¨ USB è°ƒè¯•ï¼š
   - è®¾ç½® â†’ å¼€å‘è€…é€‰é¡¹ â†’ USB è°ƒè¯•
3. è¿æ¥æ‰‹æœºåˆ°ç”µè„‘
4. ä½¿ç”¨ ADB å®‰è£…ï¼š
   ```bash
   adb install app/build/outputs/apk/debug/app-debug.apk
   ```

### ç›´æ¥å®‰è£… APK

1. å°† APK ä¼ è¾“åˆ°æ‰‹æœº
2. åœ¨æ‰‹æœºæ–‡ä»¶ç®¡ç†å™¨ä¸­ç‚¹å‡» APK
3. å…è®¸"æœªçŸ¥æ¥æº"å®‰è£…
4. å®Œæˆå®‰è£…

## âš™ï¸ é…ç½®è¯´æ˜

### é¦–æ¬¡ä½¿ç”¨

1. **æ‰“å¼€ APP**
   - å›¾æ ‡ï¼šğŸ’§ æ°´æ»´å›¾æ ‡
   - åç§°ï¼šæ°´å¡”ç›‘æ§

2. **é…ç½® ESP8266 IP åœ°å€**
   - é»˜è®¤ï¼š`http://192.168.4.1` (AP æ¨¡å¼)
   - æˆ–ï¼šESP8266 åœ¨ä½  WiFi ä¸­çš„ IP (å¦‚ `http://192.168.1.100`)
   - è¿›å…¥ è®¾ç½® â†’ æœåŠ¡å™¨åœ°å€ â†’ è¾“å…¥ IP â†’ ä¿å­˜

3. **è¿æ¥æµ‹è¯•**
   - è¿”å›ä¸»ç•Œé¢
   - ä¸‹æ‹‰åˆ·æ–°
   - åº”èƒ½çœ‹åˆ°æ°´å¡”åˆ—è¡¨

### è¿æ¥æ¨¡å¼

**æ¨¡å¼ 1: AP æ¨¡å¼ (ESP8266 çƒ­ç‚¹)**
- ESP8266 åˆ›å»º WiFi çƒ­ç‚¹
- æ‰‹æœºè¿æ¥è¯¥çƒ­ç‚¹
- IP åœ°å€ï¼š`192.168.4.1`
- ä¼˜ç‚¹ï¼šæ— éœ€è·¯ç”±å™¨ï¼Œéšæ—¶éšåœ°è¿æ¥
- ç¼ºç‚¹ï¼šæ‰‹æœºæ— æ³•è®¿é—®äº’è”ç½‘

**æ¨¡å¼ 2: è·¯ç”±æ¨¡å¼ (æ¨è)**
- ESP8266 è¿æ¥åˆ°ä½ çš„ WiFi è·¯ç”±å™¨
- æ‰‹æœºè¿æ¥åŒä¸€ WiFi
- IP åœ°å€ï¼šè·¯ç”±å™¨åˆ†é…çš„ IP (å¦‚ `192.168.1.100`)
- ä¼˜ç‚¹ï¼šæ‰‹æœºå¯åŒæ—¶è®¿é—®äº’è”ç½‘
- ç¼ºç‚¹ï¼šéœ€è¦ WiFi è·¯ç”±å™¨

## ğŸ¨ ç•Œé¢è¯´æ˜

### ä¸»ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ°´å¡”ç›‘æ§           [è®¾ç½®] [å†å²]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨¡å¼ï¼šè‡ªåŠ¨  |  åœ¨çº¿ï¼š3/4       â”‚
â”‚  [åˆ·æ–°]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ°´å¡” 1              45%   â”‚  â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ.......... [æ³µ]   â”‚  â”‚
â”‚  â”‚ åœ¨çº¿ | è‡ªåŠ¨ | æ­£å¸¸        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ°´å¡” 2              78%   â”‚  â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ....        â”‚  â”‚
â”‚  â”‚ åœ¨çº¿ | è‡ªåŠ¨ | æ­£å¸¸        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ°´æ³µæ§åˆ¶å¯¹è¯æ¡†

ç‚¹å‡»ä»»æ„æ°´å¡”å¡ç‰‡ï¼š
- æ˜¾ç¤ºå½“å‰æ°´ä½
- å¼€å¯/å…³é—­æ°´æ³µæŒ‰é’®
- ç¡®è®¤æ“ä½œ

### è®¾ç½®ç•Œé¢

- **æœåŠ¡å™¨åœ°å€**: ESP8266 çš„ IP åœ°å€
- **åˆ·æ–°é—´éš”**: 5-60 ç§’
- **é€šçŸ¥å¼€å…³**: æŠ¥è­¦é€šçŸ¥
- **å…³äº**: ç‰ˆæœ¬ä¿¡æ¯

### å†å²è®°å½•ç•Œé¢

- æ—¥æœŸé€‰æ‹©å™¨
- æ°´ä½å˜åŒ–æ›²çº¿å›¾
- æœ€é«˜/æœ€ä½æ°´ä½ç»Ÿè®¡

## ğŸ”Œ API æ¥å£

APP é€šè¿‡ REST API ä¸ ESP8266 é€šä¿¡ï¼š

### è·å–çŠ¶æ€
```
GET /api/status
Response:
{
  "mode": 0,
  "wifi": true,
  "well_water": true,
  "towers": [
    {
      "id": 1,
      "level": 45,
      "pump": false,
      "online": true
    }
  ]
}
```

### æ§åˆ¶æ°´æ³µ
```
POST /api/pump
Body: tower=1&action=on
Response: OK
```

### åˆ‡æ¢æ¨¡å¼
```
POST /api/mode
Body: mode=0 (è‡ªåŠ¨) æˆ– mode=1 (æ‰‹åŠ¨)
Response: OK
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨

**å¯èƒ½åŸå› :**
- IP åœ°å€é”™è¯¯
- æ‰‹æœºå’Œ ESP8266 ä¸åœ¨åŒä¸€ç½‘ç»œ
- ESP8266 æœªå¯åŠ¨ Web æœåŠ¡å™¨

**è§£å†³æ–¹æ³•:**
1. æ£€æŸ¥ IP åœ°å€æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ‰‹æœºè¿æ¥æ­£ç¡®çš„ WiFi
3. åœ¨æµè§ˆå™¨è®¿é—® `http://IP/api/status` æµ‹è¯•
4. æ£€æŸ¥ ESP8266 ä¸²å£æ—¥å¿—

### é—®é¢˜ï¼šæ•°æ®åˆ·æ–°å¤±è´¥

**å¯èƒ½åŸå› :**
- WiFi ä¿¡å·å¼±
- ESP8266 å¤„ç†ä¸è¿‡æ¥
- ä»æœºç¦»çº¿

**è§£å†³æ–¹æ³•:**
1. å¢åŠ åˆ·æ–°é—´éš” (è®¾ç½® â†’ åˆ·æ–°é—´éš”)
2. æ£€æŸ¥æ°´å¡”åœ¨çº¿çŠ¶æ€
3. é‡å¯ ESP8266

### é—®é¢˜ï¼šæ°´æ³µæ§åˆ¶æ— å“åº”

**å¯èƒ½åŸå› :**
- ä»æœºç¦»çº¿
- LoRa é€šä¿¡æ•…éšœ
- ç»§ç”µå™¨æŸå

**è§£å†³æ–¹æ³•:**
1. æ£€æŸ¥ä»æœºåœ¨çº¿çŠ¶æ€
2. æŸ¥çœ‹ ESP8266 ä¸²å£æ—¥å¿—
3. æ‰‹åŠ¨æµ‹è¯•ç»§ç”µå™¨

## ğŸ“¦ ä¾èµ–åº“

```gradle
// AndroidX
implementation 'androidx.core:core-ktx:1.12.0'
implementation 'androidx.appcompat:appcompat:1.6.1'
implementation 'com.google.android.material:material:1.11.0'
implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
implementation 'androidx.lifecycle:lifecycle-runtime-ktx:2.7.0'

// RecyclerView
implementation 'androidx.recyclerview:recyclerview:1.3.2'

// Retrofit (HTTP å®¢æˆ·ç«¯)
implementation 'com.squareup.retrofit2:retrofit:2.9.0'
implementation 'com.squareup.retrofit2:converter-gson:2.9.0'
implementation 'com.squareup.okhttp3:logging-interceptor:4.12.0'

// MPAndroidChart (å›¾è¡¨)
implementation 'com.github.PhilJay:MPAndroidChart:v3.1.0'
```

## ğŸ“ å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
app/src/main/java/com/watertower/monitor/
â”œâ”€â”€ MainActivity.kt      # ä¸»ç•Œé¢
â”œâ”€â”€ ApiService.kt        # API æ¥å£å®šä¹‰
â”œâ”€â”€ ApiClient.kt         # API å®¢æˆ·ç«¯ç®¡ç†å™¨
â”œâ”€â”€ TowerAdapter.kt      # æ°´å¡”åˆ—è¡¨é€‚é…å™¨
â”œâ”€â”€ models.kt            # æ•°æ®æ¨¡å‹
â”œâ”€â”€ SettingsActivity.kt  # è®¾ç½®ç•Œé¢
â””â”€â”€ HistoryActivity.kt   # å†å²è®°å½•ç•Œé¢
```

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ·»åŠ æ–°çš„ API æ¥å£**
   - ç¼–è¾‘ `ApiService.kt`
   - æ·»åŠ æ¥å£æ–¹æ³•

2. **æ·»åŠ æ–°çš„æ•°æ®å­—æ®µ**
   - ç¼–è¾‘ `models.kt`
   - åœ¨ `TowerData` ç±»ä¸­æ·»åŠ å­—æ®µ

3. **æ›´æ–° UI**
   - ç¼–è¾‘å¯¹åº”çš„ Activity æˆ– Adapter
   - ä¿®æ”¹å¸ƒå±€æ–‡ä»¶

### ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬

```bash
# 1. ä¿®æ”¹ app/build.gradle ä¸­çš„ versionCode å’Œ versionName
# 2. ç”Ÿæˆç­¾åå¯†é’¥ (é¦–æ¬¡)
keytool -genkey -v -keystore watertower.keystore -alias watertower -keyalg RSA -keysize 2048 -validity 10000

# 3. åœ¨ gradle.properties ä¸­é…ç½®ç­¾å
# 4. ç¼–è¯‘ Release ç‰ˆæœ¬
./gradlew assembleRelease

# 5. APK ä½ç½®
app/build/outputs/apk/release/app-release.apk
```

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

---

**ç‰ˆæœ¬**: 1.0.0  
**ä½œè€…**: Wlinuxhv  
**æ›´æ–°**: 2026-02-28
