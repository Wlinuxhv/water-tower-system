name: Android CI

on:
  push:
    paths:
      - 'water_tower_system/android_app/**'
    branches: [ main, master ]
  pull_request:
    paths:
      - 'water_tower_system/android_app/**'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½® JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
      
    - name: æˆäºˆ Gradle æƒé™
      run: chmod +x water_tower_system/android_app/gradlew
      
    - name: ä½¿ç”¨ Gradle æ„å»º
      working-directory: water_tower_system/android_app
      run: |
        ./gradlew clean
        ./gradlew assembleRelease
        
    - name: ä¸Šä¼  APK
      uses: actions/upload-artifact@v4
      with:
        name: water-tower-monitor-apk
        path: water_tower_system/android_app/app/build/outputs/apk/release/*.apk
        
    - name: åˆ›å»º Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: water_tower_system/android_app/app/build/outputs/apk/release/*.apk
        body: |
          ## ğŸ“± æ°´å¡”ç›‘æ§ç³»ç»Ÿ Android APP
          
          ### æ›´æ–°å†…å®¹
          - å®æ—¶æ°´ä½ç›‘æ§
          - æ°´æ³µè¿œç¨‹æ§åˆ¶
          - è‡ªåŠ¨/æ‰‹åŠ¨æ¨¡å¼åˆ‡æ¢
          - ç¼ºæ°´æŠ¥è­¦é€šçŸ¥
          - å†å²è®°å½•æŸ¥è¯¢
          
          ### å®‰è£…è¯´æ˜
          1. ä¸‹è½½ APK æ–‡ä»¶
          2. åœ¨ Android è®¾å¤‡ä¸Šå…è®¸"æœªçŸ¥æ¥æº"å®‰è£…
          3. å®‰è£…å¹¶è¿è¡Œ
          
          ### è¿æ¥é…ç½®
          - é»˜è®¤ IP: 192.168.4.1 (ESP8266 AP æ¨¡å¼)
          - æˆ–åœ¨è®¾ç½®ä¸­è‡ªå®šä¹‰ IP åœ°å€
